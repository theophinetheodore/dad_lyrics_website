{{ define "main" }}

{{/* Breadcrumbs */}}

{{ if not .IsHome }}
{{ partial "breadcrumbs.html" . }}
{{ end }}

<div {{ if .Param "autonumber" }} class="autonumber" {{ end }}>
  <article data-pagefind-body>

  {{ if .Param "notation"}}
   <table>
      <tr><th colspan="2" style="text-align: center; font-size: 1.5rem;">സൂചിക</th></tr>

      <tr>
        <td>M</td>
        <td>പുരുഷന്മാർ ആലപിക്കുന്നു</td>
      </tr>
      <tr>
        <td>F</td>
        <td>സ്ത്രീകൾ ആലപിക്കുന്നു</td>
      </tr>
      <tr>
        <td>M/F</td>
        <td>പുരുഷന്മാർക്കു ശേഷം സ്ത്രീകൾ ആലപിക്കുന്നു</td>
      </tr>
      <tr>
        <td>F/M</td>
        <td>സ്ത്രീകൾക്കു ശേഷം പുരുഷന്മാർ ആലപിക്കുന്നു</td>
      </tr>
      <tr>
        <td>C</td>
        <td>ഇരുകൂട്ടരും ചേർന്ന് ആലപിക്കുന്നു</td>
      </tr>
    </table>
    {{ end }}

    <header class="single-intro-container">
        {{- /* Title and Summary */}}
        
        <h1 class="single-title">{{ .Title }}</h1>
        {{- with .Param "summary" }}
        <p class="single-summary">{{ . | markdownify }}</p>
        {{- end }}
   
        {{- /* Date, Reading Time and Author */}}
        {{ if or (or (.Param "author") (.Param "authorAvatarPath")) (or .Date (.Param "readTime")) }}
        <div class="single-subsummary">
          {{ with $.Param "authorAvatarPath" }}
            <img src="{{ . }}" alt="Author Avatar" />
          {{ end }}
          <div>
            {{ with .Param "author" }}
            <p class="author"> {{- .}} </p>
            {{ end }}
            <!-- <p class="single-date"> -->
            <!-- {{- with .Date }} -->
            <!--   {{- $dateMachine := . | time.Format "2006-01-02T15:04:05-07:00" }} -->
            <!--   {{- $dateHuman := . | time.Format (default ":date_long" $.Site.Params.singleDateFormat) }} -->
            <!--   <time datetime="{{ $dateMachine }}">{{ $dateHuman }}</time> -->
            <!-- {{- end }} -->
            <!---->
            <!-- {{- if .Param "readTime" }} -->
            <!--   {{ if .Date }}&nbsp; · &nbsp;{{ end }} -->
            <!--   {{- .ReadingTime }} min read -->
            <!-- {{- end }} -->
            <!-- </p> -->
          </div>
        </div>
        {{- end}}
        
    </header>
    
      {{- $taxonomy := "tags" }}
      {{- with .Param $taxonomy }}    
        <div class="single-tags"
        style="margin: 1rem 0; display: flex; justify-content: space-between; align-items: center;">
          <div class="tags-inner">
            {{- range $index, $tag := . }}
              {{- with $.Site.GetPage (printf "/%s/%s" $taxonomy $tag) -}}
                  <a href="{{ .Permalink }}">{{ .LinkTitle }}</a>
              {{- end }}
            {{- end }}
          </div>

          <button id="tag" onClick="shareLink()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M17 22q-1.25 0-2.125-.875T14 19q0-.15.075-.7L7.05 14.2q-.4.375-.925.588T5 15q-1.25 0-2.125-.875T2 12t.875-2.125T5 9q.6 0 1.125.213t.925.587l7.025-4.1q-.05-.175-.062-.337T14 5q0-1.25.875-2.125T17 2t2.125.875T20 5t-.875 2.125T17 8q-.6 0-1.125-.213T14.95 7.2l-7.025 4.1q.05.175.063.338T8 12t-.012.363t-.063.337l7.025 4.1q.4-.375.925-.587T17 16q1.25 0 2.125.875T20 19t-.875 2.125T17 22"/></svg>
          പങ്കുവയ്ക്കുക</button>
        </div>
      {{- end }}
    
    {{- /* Table of Contents */}}
    
    {{- if .Param "toc" }}
      <aside class="toc">
        <p><strong>Table of contents</strong></p>
        {{ .TableOfContents }}
      </aside>
    {{- end }}
    
    {{- /* Page content */}}

  <div id="details" style="display: flex; flex-direction: column; margin: 1.5rem 0;">
    {{ if .Param "scale" }}
      <span><b>Scale</b>: {{ .Params.scale }}</span>
    {{ end }}

    {{ if .Param "time_signature"}}
      <span><b>Time Signature</b>: {{ .Params.time_signature }}</span>
    {{ end }}

    {{ if .Param "tempo"}}
      <span><b>Tempo</b>: {{ .Params.tempo }}</span>
    {{ end }}
  </div>

  {{ if .Param "video" }}
  <iframe id="preview" src={{ replace .Params.video "watch?v=" "embed/" }} frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
  {{ end }}

    {{ if .Param "notation"}}
      <div class="notation-container" id="notation-container">
      </div>
    {{ end }}
    
    {{ if .Param "notation"}}
      <div class="single-content hidden" id="single-content">
    {{ else }}
      <div class="single-content" style="margin-top: -1rem;" id="single-content">
    {{ end }}
      {{ .Content }}
    </div>

  </article>
  
  {{- /* Comments */}}

  {{- if and .Site.Params.giscus.enable (not .Params.disableComment) }}
    <div class="single-comments">
      {{ partial "comments.html" . }}
    </div>
  {{- end }}

  {{ if .Store.Get "hasMermaid" }}
  {{ $mermaidDarkTheme := default "dark" (or .Params.mermaidDarkTheme .Site.Params.mermaidDarkTheme) }}
  {{ $mermaidTheme := default "default" (or .Params.mermaidTheme .Site.Params.mermaidTheme) }}
  <script defer
    type="module"
    id="mermaid_script"
    data-light-theme="{{ $mermaidTheme }}"
    data-dark-theme="{{ $mermaidDarkTheme }}"
    src='{{ "js/mermaid.js" | relURL }}'>
  </script>
  {{ end }}

  {{/* Next prev controls */}}

  {{ if not (.Param "hidePagination") }}
  {{ partial "pagination-single.html" . }}
  {{ end }}

  {{/* Back to top */}}

  {{ if not (.Param "hideBackToTop") }}
  <div class="back-to-top">
    <a href="#top">
      back to top
    </a>
  </div>
  {{ end }}

  {{ if .Param "notation"}}
    <script defer src="/tabular_view.js"></script>
  {{ end }}

  <script>
    function showToast() {
      const toast = document.getElementById('toast');
      toast.classList.add('show');
      setTimeout(() => {
          toast.classList.remove('show');
      }, 3000);
    }

    async function shareLink() {
      const url = window.location.href;

      if (navigator.share) {
          try {
              await navigator.share({
                  title: document.title,
                  url: url
              });
              console.log('Shared successfully');
          } catch (error) {
              console.error('Error sharing:', error);
          }
      } else {
          try {
              await navigator.clipboard.writeText(url);
              console.log('Copied to clipboard:', url);
              showToast();
          } catch (error) {
              console.error('Error copying to clipboard:', error);
          }
      }
    }
  </script>

</div>

<div class="toast" id="toast">ലിങ്ക് കോപ്പി ചെയ്യപ്പെട്ടു!</div>

{{ end }}
